(function(){const URLOfNewestJSON="/blog/newest.json";var viewp=getURLParameter("view");var typep=getURLParameter("type");if(!viewp||typep=="list"||(!viewp&&!typep)){getJSON(URLOfNewestJSON,"list")}else if(viewp){if(!typep||typep=="article"){getJSON(viewp,"article")}else{getJSON(viewp,typep)}}}());function getURLParameter(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(reg);if(r!=null&&r!=""){return unescape(r[2])}return false}function getJSON(url,loadMethod){if(loadMethod=="list"){fetch(url).then((response)=>{return response.json()}).then((json)=>{loadList(url,json,15,true)})}else{fetch("/blog/"+url+".json").then((response)=>{return response.json()}).then((json)=>{loadContent(loadMethod,url,json)})}}function loadList(url,pjson,step,fromNewp){if(fromNewp){url=pjson.newest}var t=0;getJSON2(url,t,step)}function getJSON2(url,t,step){if(t<step){fetch("/blog/"+url+".json").then((response)=>{return response.json()}).then((json)=>{createCardByJson(json);if(json.previous!=""){getJSON2(json.previous,t++,step)}else{createCardByJson(0)}})}else{return}}function createCardByJson(json){if(json==0){var card="<div id='no-more'><p>没有更多了</p></div>"}else{var beginCard="<div class='card flipInX animated "+json.type+"'>";var cardTitle="<a class='card-title' href='blog?view="+json.url+"'>"+json.title+"</a>";var beginCardSub="<div class='card-sub'>";var creatTime="<span class='glyphicon glyphicon-calendar'></span><span class='creat-time'>"+json.creatTime+"</span>";var cardTags="<span class='glyphicon glyphicon-tags'></span>";for(var i=0;i<parseInt(json.tags.length);i++){cardTags+=("<a class='card-tag' href='/blog?tag="+json.tags[i]+"'>"+json.tags[i]+"</a>");if(parseInt(json.tags.length)-i>=2){cardTags+="<span class='tag-separater'></span>"}}var endCardSub="</div>";var mediaBegin=((json.thumbnail=="")?"":"<div class='media'><div class='media-left media-middle'><img class='media-object media-object-in-card img-thumbnail' src='/blog/source/media/"+json.thumbnail+"' alt='"+json.title+"'></div><div class='media-body'>");var cardBody="<a class='card-body' href='blog?view="+json.url+"'><p>"+json.description+"</p></a>";var mediaEnd=((json.thumbnail=="")?"":"</div></div>");var readMore="<a href='blog?view="+json.url+"'><p class='text-right read-more'></br></p></a>";var endCard="</div>";var card=beginCard+cardTitle+beginCardSub+creatTime+cardTags+endCardSub+mediaBegin+cardBody+mediaEnd+readMore+endCard}$("#blog-list").append(card)}function loadContent(loadMethod,viewURL,json){var url="/blog/"+viewURL+".html";$.get(url,function(data){$("#blog-content").html(data);$("title").html(json.title+" | 胡言")});setBottomIndexes(json);setRecentRead(json)}function setBottomIndexes(json){var div="<nav id='indexes'> <ul class='pager'>";var indexOfPrevious="<li class='previous'><a "+((json.previous=="")?">再往前没有啦":"href='/blog?view="+json.previous+"'><span class='glyphicon glyphicon-arrow-left' aria-hidden='true'></span> "+json.previousTitle+"</a></li>");var indexOfNext="<li class='next'><a "+((json.next=="")?">再往后没有啦":"href='/blog?view="+json.next+"'>"+json.nextTitle+" <span class='glyphicon glyphicon-arrow-right' aria-hidden='true'></span></a></li>");$("#main").append(div+indexOfPrevious+indexOfNext+"</ul></nav>")}function setRecentRead(json){if(localStorage.recentReadOne==json.title){localStorage.recentReadOneUrl=json.url}else{if(localStorage.recentReadTwo==json.title){localStorage.recentReadTwo=localStorage.recentReadOne;localStorage.recentReadTwoUrl=localStorage.recentReadOneUrl;localStorage.recentReadOne=json.title;localStorage.recentReadOneUrl=json.url}else{localStorage.recentReadThree=localStorage.recentReadTwo;localStorage.recentReadThreeUrl=localStorage.recentReadTwoUrl;localStorage.recentReadTwo=localStorage.recentReadOne;localStorage.recentReadTwoUrl=localStorage.recentReadOneUrl;localStorage.recentReadOne=json.title;localStorage.recentReadOneUrl=json.url}}}